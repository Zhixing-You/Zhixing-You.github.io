{% include base_path %}

{% if post.id %}
  {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
{% else %}
  {% assign title = post.title %}
{% endif %}

{% comment %} Extract author and year from citation {% endcomment %}
{% if post.citation %}
  {% assign citation_no_html = post.citation | replace: '<a href="', '' | replace: '">', ' ' | replace: '</a>', '' | replace: '<i>', '' | replace: '</i>', '' | replace: '&quot;', '"' | replace: '&amp;', '&' %}
  {% comment %} Find the part with author and year (before the title in quotes) {% endcomment %}
  {% assign title_quoted = title | prepend: '"' | append: '"' %}
  {% assign citation_before_title = citation_no_html | split: title_quoted | first | strip %}
  {% comment %} Remove trailing period and clean up {% endcomment %}
  {% assign author_year = citation_before_title | replace: '.', '' | strip %}
{% else %}
  {% assign author_year = '' %}
  {% if post.date %}
    {% assign author_year = post.date | date: "(%Y)" %}
  {% endif %}
{% endif %}

<div class="publication-item" style="font-size: 0.95em; line-height: 1.6;">
  {% comment %} Title {% endcomment %}
  {% if post.paperurl %}
    <a href="{{ post.paperurl }}" target="_blank" style="color: #1a0dab; text-decoration: none; font-weight: 500;">{{ title }}</a>
  {% else %}
    <span style="font-weight: 500;">{{ title }}</span>
  {% endif %}
  
  {% comment %} Author and year {% endcomment %}
  {% if author_year != '' %}
    <span>. {{ author_year }}</span>
  {% endif %}
  
  {% comment %} Venue {% endcomment %}
  {% if post.venue %}
    <span>. {{ post.venue }}</span>
  {% endif %}
  
  {% comment %} Links - support both DOI and arXiv {% endcomment %}
  {% assign has_doi = false %}
  {% assign has_arxiv = false %}
  
  {% if post.doi %}
    {% assign has_doi = true %}
  {% elsif post.paperurl and post.paperurl contains 'doi.org' %}
    {% assign has_doi = true %}
  {% endif %}
  
  {% if post.arxiv %}
    {% assign has_arxiv = true %}
  {% elsif post.paperurl and post.paperurl contains 'arxiv.org' %}
    {% assign has_arxiv = true %}
  {% endif %}
  
  {% if has_doi or has_arxiv %}
    <span>.</span>
  {% endif %}
  
  {% comment %} Display DOI link {% endcomment %}
  {% if post.doi %}
    <a href="https://doi.org/{{ post.doi }}" target="_blank" style="color: #1a0dab; text-decoration: none; margin-left: 0.3em;">[DOI]</a>
  {% elsif post.paperurl and post.paperurl contains 'doi.org' %}
    <a href="{{ post.paperurl }}" target="_blank" style="color: #1a0dab; text-decoration: none; margin-left: 0.3em;">[DOI]</a>
  {% endif %}
  
  {% comment %} Display arXiv link {% endcomment %}
  {% if post.arxiv %}
    <a href="https://arxiv.org/abs/{{ post.arxiv }}" target="_blank" style="color: #1a0dab; text-decoration: none; margin-left: 0.3em;">[arXiv]</a>
  {% elsif post.paperurl and post.paperurl contains 'arxiv.org' %}
    <a href="{{ post.paperurl }}" target="_blank" style="color: #1a0dab; text-decoration: none; margin-left: 0.3em;">[arXiv]</a>
  {% endif %}
  
  {% comment %} Display other paperurl if neither DOI nor arXiv {% endcomment %}
  {% if post.paperurl and not has_doi and not has_arxiv %}
    <span>.</span>
    <a href="{{ post.paperurl }}" target="_blank" style="color: #1a0dab; text-decoration: none; margin-left: 0.3em;">[PDF]</a>
  {% endif %}
</div>

