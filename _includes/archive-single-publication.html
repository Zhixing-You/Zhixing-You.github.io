{% include base_path %}

{% if post.id %}
  {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
{% else %}
  {% assign title = post.title %}
{% endif %}

{% comment %} Get author and year from author field {% endcomment %}
{% if post.author %}
  {% assign author_year = post.author %}
{% elsif post.date %}
  {% assign author_year = post.date | date: "(%Y)" %}
{% else %}
  {% assign author_year = '' %}
{% endif %}

<div class="publication-item" style="font-size: 0.95em; line-height: 1.6;">
  {% comment %} Title with link (if available) {% endcomment %}
  {% if post.paperurl %}
    <a href="{{ post.paperurl }}" target="_blank" style="color: #1a0dab; text-decoration: none; font-weight: 500;">{{ title }}</a>
  {% elsif post.doi %}
    <a href="https://doi.org/{{ post.doi }}" target="_blank" style="color: #1a0dab; text-decoration: none; font-weight: 500;">{{ title }}</a>
  {% elsif post.arxiv %}
    <a href="https://arxiv.org/abs/{{ post.arxiv }}" target="_blank" style="color: #1a0dab; text-decoration: none; font-weight: 500;">{{ title }}</a>
  {% else %}
    <span style="font-weight: 500;">{{ title }}</span>
  {% endif %}
  
  {% comment %} Author and year {% endcomment %}
  {% if author_year != '' %}
    <span>. {{ author_year }}</span>
  {% endif %}
  
  {% comment %} Venue - skip if it's redundant with author field {% endcomment %}
  {% if post.venue %}
    {% assign skip_venue = false %}
    {% if post.author %}
      {% if post.author contains '(in preparation)' and post.venue == 'In preparation' %}
        {% assign skip_venue = true %}
      {% elsif post.author contains '(in preparation)' and post.venue contains 'preparation' %}
        {% assign skip_venue = true %}
      {% elsif post.author contains 'Submitted' and post.venue == 'Submitted' %}
        {% assign skip_venue = true %}
      {% endif %}
    {% endif %}
    {% unless skip_venue %}
      <span>. {{ post.venue }}</span>
    {% endunless %}
  {% endif %}
  
  {% comment %} Links - support both DOI and arXiv {% endcomment %}
  {% assign has_doi = false %}
  {% assign has_arxiv = false %}
  
  {% if post.doi %}
    {% assign has_doi = true %}
  {% elsif post.paperurl and post.paperurl contains 'doi.org' %}
    {% assign has_doi = true %}
  {% endif %}
  
  {% if post.arxiv %}
    {% assign has_arxiv = true %}
  {% elsif post.paperurl and post.paperurl contains 'arxiv.org' %}
    {% assign has_arxiv = true %}
  {% endif %}
  
  {% if has_doi or has_arxiv %}
    <span>.</span>
  {% endif %}
  
  {% comment %} Display DOI link {% endcomment %}
  {% if post.doi %}
    <a href="https://doi.org/{{ post.doi }}" target="_blank" style="color: #1a0dab; text-decoration: none; margin-left: 0.3em;">[DOI]</a>
  {% elsif post.paperurl and post.paperurl contains 'doi.org' %}
    <a href="{{ post.paperurl }}" target="_blank" style="color: #1a0dab; text-decoration: none; margin-left: 0.3em;">[DOI]</a>
  {% endif %}
  
  {% comment %} Display arXiv link {% endcomment %}
  {% if post.arxiv %}
    <a href="https://arxiv.org/abs/{{ post.arxiv }}" target="_blank" style="color: #1a0dab; text-decoration: none; margin-left: 0.3em;">[arXiv]</a>
  {% elsif post.paperurl and post.paperurl contains 'arxiv.org' %}
    <a href="{{ post.paperurl }}" target="_blank" style="color: #1a0dab; text-decoration: none; margin-left: 0.3em;">[arXiv]</a>
  {% endif %}
  
  {% comment %} Display other paperurl if neither DOI nor arXiv {% endcomment %}
  {% if post.paperurl and not has_doi and not has_arxiv %}
    <span>.</span>
    <a href="{{ post.paperurl }}" target="_blank" style="color: #1a0dab; text-decoration: none; margin-left: 0.3em;">[PDF]</a>
  {% endif %}
</div>

